---
title: C++ 02 - 堆与栈
date: 2018-08-26 09:40:26
categories: C++
---
# 堆与栈

<!--more-->

C++中堆与栈有如下区别:

1. 管理方式

    对于栈来讲, 是由编译器自动管理的. 

    对于堆来讲, 需要通过delete来控制.

2. 空间大小

    栈空间大小根据编译器参数制约, 一般为1MB. 

    堆空间是根据机器字长决定的.

3. 生长方向

    栈是向下增长的, 也就是向着内存地址减小的方向增长的. 
    
    堆是向上增长的, 也就是向着内存地址增加的方向增长.

4. 分配方式

    栈有两种分配方式: 静态分配和动态分配. 静态分配是编译器完成的, 比如局部变量的分配. 动态分配由alloca函数分配.

    堆是动态分配的, 通过malloc, realloc, calloc, new等方式申请.

4. 回收方式

    栈由编译器自动回收释放.

    堆需要free, delete等方式手动释放.

5. 分配效率

    栈是系统提供的数据结构, 机器会在底层对栈提供支持, 分配专门的寄存器存放栈的地址, 压栈出栈都有专门的指令执行, 这就决定了栈的效率比较高.

    堆的分配是由上层的库函数提供分配算法. 如果没有足够的大小, 可能会进行系统调用去增加程序数据段的内存空间. 同时多次的new/delete会导致内存碎片. 这都使得分配的效率要低于栈.